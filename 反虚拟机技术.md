1、检测虚拟机一般技术主要是搜索相关VM虚拟机的字符串，如搜索虚拟机服务进程使用CreateToolHelper32Snapshot-对用户选择的类型进行快照、
Process32First-从快照中检索进程信息、
Process32Next三个函数遍历进程。
2、使用内存检测虚拟机
内存映射中，如检测IDT（Interrupt Descriptor Table）中的地址，VMWare虚拟机中IDT地址为0xFFxxxxxx,而物理机IDT地址不会高于0xD0xxxxxx.因此课通过执行SIDT指令检测IDTR(Interrupt Descripter Table Register)，IDTR用于存放IDT地址，然后判断返回LowIDTbase的第一个字节是否高于0xD0,以此来检测虚拟机环境。
同理可以检测LDT(Local Descriptor Table)与GDT(Global Descriptor Table)，当LDT位于0x0000时，为物理主机；当GDT位于0xFFxxxxxxx时为虚拟主机。

![[fb085b059b6b1bc8215394f1620eca0.jpg]]