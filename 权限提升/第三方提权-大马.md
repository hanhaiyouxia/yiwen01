==**向日葵**==
向日葵是一款面向企业和专业人员的远程pc管理和控制的服务软件。可以在任何有网络的情况下，轻松访问并控制安装了向日葵客户端的远程主机。同时还能实现远程文件传输、远程视频监控等功能，这不仅为用户的使用带来很多便捷，还能为其提供各类保障。

影响版本：
向日葵个人版for Windows <= 11.0.0.33
向日葵简约版 <= V1.0.1.43315（2021.12）

1、当查看到目标服务中存在：SunloginClient.exe或者SunloginService时，即可判断目标服务器中安装了向日葵
tasklist /svc

2、向日葵运行状态下会自动随机开启一个大于40000的端口。
nmap -p 40000-65535
探测到端口之后，尝试使用本地浏览器去一个个访问这些端口，看返回值可以找到结果

3、找到正确的端口之后，直接上工具连接：==Sunlogin漏洞利用工具.jar==
java -jar Sunlogin漏洞利用工具.jar
![[1729496621537.jpg]]
手工漏洞利用方式 :  https://blog.csdn.net/weixin_53440207/article/details/129248545

==============================================================================================================================
**==VNC提权：（默认端口：5900）==**
VNC (Virtual Network Console)是虚拟网络控制台的缩写。它是一款优秀的远程控制工具软件，
由著名的 AT&T 的欧洲研究实验室开发的。VNC 是在基于 UNIX和 Linux 操作系统的免费的开源软件，远程控制能力强大，高效实用，其性能可以和 Windows 和 MAC 中的任何远程控制软件媲美。

提权思路：目标服务器管理员为了管理服务器方便，可能会在服务器上面安装远控软件例如：VNC
安装VNC后会在注册表中保留VNC的密码，我们可以利用VNC的这个特质。拿到webshell之后远程读取注册表中的密码信息。拿到服务端的密码之后，我们可以在本地安装VNC然后去远程连接目标服务，来达到提权的目的！

1，通过菜刀上传大马：dama.asp
注意此脚本的格式：.asp结尾的脚本是需要iis中间件去解析的。
密码：Skull.

2，本地浏览器访问木马（大马的界面如下图所示）
`http://192.168.163.136:82/dama.asp`

大马可能会读取注册表值失败：因为读取注册表需要管理员权限。而iis网站运行一般都是iuser用户（来宾用户）再者，万一对方服务器没有开启iis中间件的时候：.asp的木马也没办法使用。


除了木马的方式还可以通过webshell虚拟终端执行命令（中国菜刀、蚁剑提权）：
Cmd /c "regedit /e c:\123.reg "HKEY_LOCAL_MACHINE\software\RealVNC\WinVNC4" "
#调用CMD将注册表的键值下载到c盘，命名为123.reg

执行成功之后通过菜刀下载到本地，然后利用CMD命令行调用vncx4.exe进行密码破译：
vncx4.exe -W

![[1729497793585.jpg]]
==============================================================================================================================


==**Radmin提权：（默认端口4899）**==
Radmin 拥有最高的操作速度,使用远程计算机如同使用本地计算机一样。其特殊的低带宽优化功能使之在使用 3G 网络时,也能顺畅远程操控计算机。 是一款国外运用比较多的远控软件。

服务端安装方法：
1、将radmin文件夹上传到2003环境
2、cmd命令行切换到radmin的目录；cd C:\Documents and Settings\Administrator\桌面\rdmin
3、cmd命令行输入命令：server.exe /setup
4、设置密码（8位）；设置参数（勾选隐藏图标就相当于远控木马）；输入注册码
点击安装服务即可完成安装。

提权思路：扫描到目标服务器有安装Radmin后，可以通过webshell远程读取注册表中的密码信息并在本地破解密码进行远程连接来达到提权目的。

软件用法：
启动服务端之后，本地开启客户端：Radmin.exe
1，通过菜刀上传大马：dama.asp
密码：Skull.

2，本地浏览器访问木马可直接读取radmin的密码（hash值加密的）
![[Pasted image 20241021183443.png]]
利用脚本读取的hash值是大写的，需要转换为小写字母


或者：webshell读取密码
cmd /c "regedit /e c:\456.reg "HKEY_LOCAL_MACHINE\system\RAdmin\v2.0\Server\


3，拿到密码之后通过在线md5网站解密，得到密码之后本地远程连接目标服务器。
在线解密网站： https://cmd5.com/
或者直接使用hash值版的连接工具==Radmin_Hash.exe==去连接。


===============================================================

远控软件todesk漏洞：https://news.iresearch.cn/yx/2023/08/477532.shtml
远控软件todesk漏洞：https://mp.weixin.qq.com/s/LBBrSE7L_rnPsJMqNJaBOw

==============================================================================================================================
总结：
一般的远控软件的密码都保存在注册表键值或者配置文件；类似于向日葵这种随机产生密码的软件，一方面可以利用工具一键提权
另一方面还可以使用手工的方式获取未授权访问获取session会话来进行提权。其实利用的方式和原理都是大同小异的。












# ==**Zend提权**==
前提：拿下webshell且zend.dll可读可写
zend是什么？
==Zend是一种PHP脚本引擎，它是PHP的核心，它的作用是将PHP代码转换成可执行的机器码，它可以让程序员更快速地开发出功能强大的Web应用程序。**==

==**Zend是为网站提供加速的组件，可以提高网站的访问速度。一般的phpstudy安装完成之后会自带有这个组件，也有独立安装版。**==


==**漏洞产生的原因是因为目录权限过高：**==
==**服务器如果单独安装了Zend组件之后哪怕服务器C:\Program Files\设置过权限，Zend也会自动会把**==
==**C:\Program Files\Zend\ZendOptimizer-3.3.0\下的目录权限设为Everyone权限,这就导致入侵者能**==
==**写入文件**==


==**提权思路：我们拿到webshell之后，翻看目标网站结构的时候，如果看到目标服务器是以phpstudy搭建的，那么可以尝试使用Zend提权。****==
==**只需要通过webshell对zeng的源文件ZendExtensionManager.dll重命名，并通过工具重新生成一**==
==**个木马ZendExtensionManager.dll替换掉原来的文件。当apache重启加载，服务器就会被控制==。**

目标服务器如果使用phpstudy搭建的，那么他的Zend组件的路径默认在：（通过webshell翻阅可找
到）
默认路径C:\phpStudy\php\php-5.2.17\ZendOptimizer\


利用zend提权的操作：
1，通过webshell菜刀上传nc.exe到目标服务器的Zend目录：
上传nc是方便将nc写入到dll动态库，后面本地可以执行监听。

2，把原有的zendextensionmanager.dll改名，例如改名为“111.dll”
再通过zend工具包中的软件生成一个带后门的zendextensionmanager.dll上传到目标服务器

![[Pasted image 20241021183235.png]]


这一步的目的是改写zend的配置文件（ZendExtensionManager.dll）将我们的nc.exe使用cmd命令
行调用起来，并指定端口。



3，接下来只需等待目标服务器重启apache服务，服务器即可调用我们上传的带有后门的
zendextensionmanager.dll文件（因为我们在zendextensionmanager.dll文件中写入了以cmd的方式
调用nc.exe并指定了监听端口）。


等待服务器重启apache服务之后就可以监听到目标服务器的会话！
连接命令：telnet 目标IP 1111

================================================
原理：所有的dll文件（动态库文件）在运行时，都需要依靠属主文件（exe）去运行。所以一个软件安装完之后当里面的动态库文件没有数字签名且所属的目录权限过高时，可以加载木马去提升权限和留后门，而且此类方法还不易被发现（正常的任务管理器只能看见.exe进程，而我们的木马文件时运行在.exe里面的.dll文件，做了很深的隐藏，必须要借助专门的工具去分析动态库文件。）

进程分析工具：PCHunter32.exe和PCHunter64.exe或者火绒剑
都可以去分析进程，作为安全工程师，我们分析进程模块时重点去看蓝色的（第三方应用软件）特别是不带数字签名的。红色的（危险文件）就更应该重视了。


第三方组件提权-zend nc提权： https://blog.csdn.net/q20010619/article/details/121460314

==============================================================================================================================


# ==DLL动态库劫持==

首先我们了解一下什么是DLL文件：
DLL文件，全称Dynamic Link Library，是Windows操作系统中的一个重要概念。它是动态链接库的
缩写，用于在Windows环境中提供应用程序所需的共享功能和服务。具体来说，DLL文件包含了一系列供多个应用程序共同使用的代码、数据和资源。当一个应用程序启动时，它会请求那些由特定DLL文件提供的服务。
这样做的目的是为了减少代码和资源的重复，从而提高程序的运行效率。
DLL文件通常位于Windows系统文件夹中，如`C:\Windows\System32`。每个DLL文件都对应着特定
的功能，比如音频解码、图形显示、网络连接等。当一个应用程序需要使用这些服务时，它会首先检查是否已经加载了相关的DLL文件。如果相关DLL文件不存在或被破坏，可能会导致应用程序无法正常运行。
需要注意的是，虽然单个DLL文件可能只服务于一个应用程序，但一个应用程序可能需要多个DLL文件以实现其完整的功能。在这种情况下，所有必要的DLL文件都会被加载并参与到应用程序的执行过程中。
总结一下，DLL文件是Windows平台上的关键组成部分，它们允许应用程序共享执行特定任务的代码和其他资源，并通过动态链接机制确保正确执行。


==**DLL劫持：通过劫持一个重要的系统函数，执行任意代码。一般来说通过webshell放到有网络行为的程序目录下就可以。最好是有自升级功能的，例如杀毒软件，输入法等（输入法目录一般权限较低，比较好利用）并不是说操作系统的软件无法劫持，而是劫持操作系统的软件因为他自带数字签名，一旦运行环境异常都会有提示，特别容易被发现。**==

具体演示：
1，使用工具包中的T00ls Lpk Sethc v4.0.exe生成一个劫持木马。
键1，键2的值可对照热键代码表
密码自定义
生成的文件名是固定文件名：LPK
![[Pasted image 20241021184758.png]]

2，通过菜刀上传到目标服务器能自动升级的第三方应用软件下面（比如：输入法的安装目录、中间件目录下）（因为这些软件一般会自动升级自动启动，在自动升级和自动启动过程中就会被我们生成的dll木马劫持）

==演示效果：上传到桌面==
==上传到桌面之后，桌面上的任何可执行程序（快捷方式 和 安装程序 无效）启动的时候，都会被劫持！==

![[Pasted image 20241021185709.png]]



3，触发后门的方法：
（1）此后门是3389远程端口触发，只要目标服务器开启3389，即可利用此后门（不需要账号和密码）
（2）本地开启远程连接，在输入用户名的位置按五下Shift键（触发粘滞键）

![[Pasted image 20241021185814.png]]

（3）鼠标放在粘滞键的最后一个句号的位置，按我们设置的键1和键2的同时鼠标点击句号（如果设置了三个键就按三个键）
![[Pasted image 20241021185841.png]]


（4）成功触发后门，输入设置的密码，即可不使用账号密码远程控制目标服务器。



总结：安全在实际工作中的应用最根本的还是权限配置。每个文件夹，每个文件的属性如果说配置得当，即使你网站或者系统有漏洞，那么攻击者即使攻击进入服务器了，缺少相应的权限的情况下他也无法运行脚本或者木马。

一般文件夹配置权限：读取和执行，不给写入权限。
网站配置权限：读取和写入权限呢，不给执行权限。
用户组不要给user太高的权限。


**第三方应用软件提权总结起来无非就是几点：**
**远控类软件：找的配置文件或者注册表键值来获取账号密码**
**其他：利用工具生成对应的脚本，通过webshell上传到目标服务器的对应目录下。要么就是替换掉原有的文件，运行脚本，要么就是通过劫持来触发后门。**
**利用好这几种思路，可以在今后的渗透工作中大有可为！**